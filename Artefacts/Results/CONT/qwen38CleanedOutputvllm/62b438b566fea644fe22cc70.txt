def bash_completion():
    """
    Produce the borgmatic command by introspecting borgmatic's command-line argument parsers.
    """
    import argparse
    from borgmatic import parser
    top_parser = parser.get_parser()
    completion_script = []
    completion_script.append('_init_')
    for subparser in top_parser._subparsers._actions:
        command = subparser.dest
        command_parser = subparser.parser
        flags = parser_flags(command_parser)
        completion_script.append(f'complete -F _borgmatic_{command} {command}')
        completion_script.append(f'_borgmatic_{command}() {{')
        completion_script.append('  local cur prev words')
        completion_script.append('  _get_completion_words "$@"')
        completion_script.append('  cur=${words[1]}')
        completion_script.append('  prev=${words[2]}')
        completion_script.append('  if [[ $cur == -* ]]; then')
        completion_script.append('    _arguments "${flags[@]}"')
        completion_script.append('  else')
        completion_script.append('    _arguments "${words[1]} ${(compadd -a ${flags[@]} -s ${cur})}"')
        completion_script.append('  fi')
        completion_script.append('}}')
    return '\n'.join(completion_script)