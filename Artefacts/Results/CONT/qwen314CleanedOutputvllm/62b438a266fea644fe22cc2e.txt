import argparse
from collections import defaultdict

def parse_arguments(*unparsed_arguments):
    """
    Given command-line arguments with which this script was invoked, parse the arguments and return
    them as a dict mapping from subparser name (or "global") to an argparse.Namespace instance.
    """
    main_parser = argparse.ArgumentParser()
    subparsers = main_parser.add_subparsers(dest='subcommand')
    make_parsers(main_parser, subparsers)

    args, remaining_args = main_parser.parse_known_args(unparsed_arguments)
    subcommand = args.subcommand

    result = {'global': args}

    if subcommand:
        subparser = subparsers.choices[subcommand]
        sub_args = subparser.parse_args(remaining_args)
        result[subcommand] = sub_args

    return result