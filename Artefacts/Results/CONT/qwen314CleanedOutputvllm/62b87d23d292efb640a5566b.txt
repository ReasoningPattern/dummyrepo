import subprocess
import sys
import os
import functools
import re
import errno

def run_command(commands, args, cwd=None, verbose=False, hide_stderr=False, env=None):
    """
    Call the given command(s).
    """
    cmd = commands + args
    stdout = subprocess.PIPE if verbose else None
    stderr = subprocess.PIPE if verbose else (subprocess.DEVNULL if hide_stderr else None)
    result = subprocess.run(cmd, cwd=cwd, env=env, stdout=stdout, stderr=stderr, text=True)
    if verbose:
        if result.stdout:
            print(result.stdout)
        if not hide_stderr and result.stderr:
            print(result.stderr)
    return result.returncode