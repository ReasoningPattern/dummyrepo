

```python
import re
from typing import Set, Tuple

def find_tags(text: str, replacer: callable = None) -> Tuple[Set, str]:
    pattern = re.compile(r'#\S+')
    segments = text.split('```')
    tags = set()
    new_segments = []
    for i, seg in enumerate(segments):
        if i % 2 == 0:
            found = pattern.findall(seg)
            for t in found:
                tags.add(t)
            if replacer:
                new_seg = pattern.sub(lambda m: replacer(m.group()), seg)
            else:
                new_seg = seg
            new_segments.append(new_seg)
        else:
            new_segments.append(seg)
    new_text = '```'.join(new_segments)
    return tags, new_text
```