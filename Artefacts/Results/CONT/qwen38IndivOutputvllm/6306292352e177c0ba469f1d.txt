

```python
import re
from typing import Tuple, Set

def find_tags(text: str, replacer: callable = None) -> Tuple[Set[str], str]:
    parts = re.split(r'```(.*?)```', text, flags=re.DOTALL)
    tags = set()
    modified_text = []
    for i, part in enumerate(parts):
        if i % 2 == 1:
            modified_text.append(part)
        else:
            tag_matches = re.findall(r'#(\w+)', part)
            for tag in tag_matches:
                if test_tag(tag) and all(char not in ILLEGAL_TAG_CHARS for char in tag):
                    tags.add(tag)
            if replacer:
                part = re.sub(r'#(\w+)', lambda m: replacer(m.group(1)), part)
            modified_text.append(part)
    modified_text = ''.join(modified_text)
    return tags, modified_text
```