

```python
import os
import subprocess
from typing import Optional, Union
from pathlib import PosixPath

def prepare_repository_from_archive(
    archive_path: str,
    filename: Optional[str] = None,
    tmp_path: Union[PosixPath, str] = "/tmp",
) -> str:
    tmp_path_str = str(tmp_path)
    if filename is None:
        archive_filename = os.path.basename(archive_path)
    else:
        archive_filename = filename

    directory_name = os.path.splitext(archive_filename)[0]

    if archive_filename.endswith('.tar.gz') or archive_filename.endswith('.tgz'):
        subprocess.run(['tar', '-xzf', archive_path, '-C', tmp_path_str], check=True)
    elif archive_filename.endswith('.zip'):
        subprocess.run(['unzip', archive_path, '-d', tmp_path_str], check=True)
    else:
        raise ValueError(f"Unsupported archive format: {archive_filename}")

    repo_url = f'file://{tmp_path_str}/{directory_name}'
    return repo_url
```