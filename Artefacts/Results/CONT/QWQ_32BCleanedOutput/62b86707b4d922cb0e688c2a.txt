def on(self, hook):
    def decorator(func):
        cls = self.__class__
        if not hasattr(cls, '_registry'):
            cls._registry = {}
        if hook not in cls._registry:
            cls._registry[hook] = []
        cls._registry[hook].append(func)
        return func
    return decorator