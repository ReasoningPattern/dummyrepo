import os
import subprocess

def ansible_playbook(ir_workspace, ir_plugin, playbook_path, verbose=None,
                     extra_vars=None, ansible_args=None):
    cmd = ['ansible-playbook', playbook_path]

    if verbose is not None:
        cmd.append('-' + 'v' * verbose)

    if extra_vars:
        for k, v in extra_vars.items():
            cmd.extend(['-e', f'{k}={v}'])

    if ansible_args:
        for key, val in ansible_args.items():
            cmd.extend(['--' + key, str(val)])

    original_dir = os.getcwd()
    os.chdir(ir_workspace.path)
    try:
        result = subprocess.run(cmd, check=True, capture_output=True, text=True)
    finally:
        os.chdir(original_dir)

    return result