def difference(d1, d2, level=-1):
    """
    Return a dictionary with items from d1 not contained in d2.
    """
    def _difference(d1, d2, current_level, max_level):
        result = {}
        for key in d1:
            if key not in d2:
                result[key] = d1[key]
            else:
                val1 = d1[key]
                val2 = d2[key]
                if isinstance(val1, dict) and isinstance(val2, dict):
                    if current_level < max_level:
                        diff = _difference(val1, val2, current_level + 1, max_level)
                        if diff:
                            result[key] = diff
                elif val1 != val2:
                    result[key] = val1
        return result

    if level == -1:
        max_level = 1000  # Arbitrary large number to simulate unlimited depth
    else:
        max_level = level
    return _difference(d1, d2, 0, max_level)