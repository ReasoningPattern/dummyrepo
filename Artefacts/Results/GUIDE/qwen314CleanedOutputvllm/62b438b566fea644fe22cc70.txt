import argparse

def bash_completion():
    """
    Produce the borgmatic command by introspecting borgmatic's command-line argument parsers.
    """
    parser = argparse.ArgumentParser(description='Borgmatic command-line tool')
    subparsers = parser.add_subparsers(dest='command', help='Available commands')

    # Example commands
    create_parser = subparsers.add_parser('create', help='Create a backup')
    create_parser.add_argument('--dry-run', action='store_true', help='Dry run')

    info_parser = subparsers.add_parser('info', help='Show backup info')
    info_parser.add_argument('archive', help='Archive name')

    # Generate completion script
    commands = list(subparsers.choices.keys())
    options = []
    for subparser in subparsers.choices.values():
        for action in subparser._actions:
            if action.dest not in ('help', 'command'):
                options.append(f'--{action.dest}')

    completion_script = f"""_borgmatic() {{
    local cur prev opts
    cur=\"${{COMP_WORDS[COMP_CWORD]}}\"
    prev=\"${{COMP_WORDS[COMP_CWORD-1]}}\"
    opts=\"{ ' '.join(commands + options) }\"
    COMPREPLY=($(compgen -W \"${{opts}}\" -- \"${{cur}}\"))
}}
complete -F _borgmatic borgmatic
"""
    return completion_script