import subprocess

def _run_playbook(cli_args, vars_dict, ir_workspace, ir_plugin):
    """
    Runs ansible cli with vars dict

    :param vars_dict: dict, Will be passed as Ansible extra-vars
    :param cli_args: the list of command line arguments
    :param ir_workspace: An Infrared Workspace object represents the active workspace
    :param ir_plugin: An InfraredPlugin object of the current plugin
    :return: ansible results
    """
    # Construct the command line
    cmd = ['ansible-playbook'] + cli_args
    # Add extra vars as --extra-vars parameter
    extra_vars_str = ' '.join([f"{k}={v}" for k, v in vars_dict.items()])
    cmd += ['--extra-vars', extra_vars_str]
    # Set the working directory to the workspace's path
    workspace_path = ir_workspace.path
    # Execute the command
    result = subprocess.run(cmd, cwd=workspace_path, capture_output=True, text=True)
    # Return the result
    return {
        'stdout': result.stdout,
        'stderr': result.stderr,
        'returncode': result.returncode
    }