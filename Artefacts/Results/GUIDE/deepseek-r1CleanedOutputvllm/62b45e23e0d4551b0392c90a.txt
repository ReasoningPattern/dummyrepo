import unittest
import os
import json
from pathlib import Path

class TestValidateVersionInventories(unittest.TestCase):
    def setUp(self):
        self.version_dirs = ["1", "2", "3"]
        self.expected_root_inventory = "files.json"
        self temporarily_created_inventories = {
            "1": "content1.json",
            "2": "content2.json",
            "3": "content3.json"
        }
        
    def test_validate_version_inventories(self):
        """Test that each version has an inventory up to that point"""
        root_inventory_path = Path("1", self.expected_root_inventory)
        if not root_inventory_path.exists():
            self.fail("Root inventory file not found")
            
        for version_dir in self.version_dirs:
            inventory_path = Path(version_dir, self.expected_root_inventory)
            if not inventory_path.exists():
                self.fail(f"Inventory file not found in version directory {version_dir}")
                
        # Check for content differences
        self._validate_content_differences()
        
    def _validate_content_differences(self):
        """Check for content differences between inventories"""
        root_inventory_path = Path("1", self.expected_root_inventory)
        root_content = json.loads(root_inventory_path.read_text())
        
        for version_dir in self.version_dirs:
            inventory_path = Path(version_dir, self.expected_root_inventory)
            version_content = json.loads(inventory_path.read_text())
            
            if version_content != root_content:
                self.fail(f"Inventory content differs in version {version_dir}")
                
    def test_with_missing_inventory(self):
        """Test when a version directory is missing its inventory"""
        version_dirs = ["1", "2"]
        self temporarily_created_inventories["1"] = None
        
        self.assertRaises FileNotFoundError, self.validate_version_inventories, version_dirs
        
    def test_with_differing_inventory_content(self):
        """Test when inventories have different content"""
        version_dirs = ["1", "2"]
        self temporarily_created_inventories["1"] = "content1.json"
        self temporarily_created_inventories["2"] = "content2.json"
        
        self.assertRaises(AssertionError, self.validate_version_inventories, version_dirs)