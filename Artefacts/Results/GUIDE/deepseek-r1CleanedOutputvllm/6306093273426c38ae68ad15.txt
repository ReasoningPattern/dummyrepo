import os
import subprocess
import shlex
import click

def _run_playbook(cli_args, vars_dict, ir_workspace, ir_plugin):
    """
    Runs ansible cli with vars dict

    :param cli_args: the list of command line arguments
    :param vars_dict: dict, Will be passed as Ansible extra-vars
    :param ir_workspace: An Infrared Workspace object represents the active workspace
    :param ir_plugin: An InfraredPlugin object of the current plugin
    :return: ansible results
    """
    playbook_path = os.path.join(ir_workspace, __init__.py)
    var_str = shlex.join(vars_dict)
    command = ['ansible']
    if cli_args:
        command += cli_args
    command += ['playbook']
    command.append(playbook_path)
    if vars_dict is None:
        command += ['-e', var_str]
    else:
        command.extend(vars_dict)
    result = subprocess.run(
        command,
        text=True,
        shell=True,
        capture_output=True,
        check=False
    )
    return result