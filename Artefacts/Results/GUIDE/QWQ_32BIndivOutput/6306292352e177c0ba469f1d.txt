

```python
import re
from typing import Set, Tuple, Callable

def find_tags(text: str, replacer: Callable[[str], str] = None) -> Tuple[Set[str], str]:
    code_pattern = re.compile(r'```.*?```', re.DOTALL)
    parts = code_pattern.split(text)
    all_tags = set()
    new_parts = []
    tag_pattern = re.compile(r'#\w+')
    
    for i, part in enumerate(parts):
        if i % 2 == 0:  # non-code part
            matches = tag_pattern.findall(part)
            all_tags.update(matches)
            if replacer:
                def replace_func(match):
                    return replacer(match.group())
                replaced_part = tag_pattern.sub(replace_func, part)
                new_parts.append(replaced_part)
            else:
                new_parts.append(part)
        else:  # code part, leave as is
            new_parts.append(part)
    new_text = ''.join(new_parts)
    return (all_tags, new_text)
```