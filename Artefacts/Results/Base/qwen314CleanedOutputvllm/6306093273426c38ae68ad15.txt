import json
import subprocess

def _run_playbook(cli_args, vars_dict, ir_workspace, ir_plugin):
    """
    Runs ansible cli with vars dict

    :param vars_dict: dict, Will be passed as Ansible extra-vars
    :param cli_args: the list  of command line arguments
    :param ir_workspace: An Infrared Workspace object represents the active
     workspace
    :param ir_plugin: An InfraredPlugin object of the current plugin
    :return: ansible results
    """
    playbook_path = ir_plugin.playbook_path
    inventory_path = ir_workspace.inventory
    cmd = ['ansible-playbook', playbook_path, '--inventory', inventory_path]
    if vars_dict:
        cmd.extend(['-e', json.dumps(vars_dict)])
    cmd += cli_args
    result = subprocess.run(cmd, capture_output=True, text=True)
    return {
        'stdout': result.stdout,
        'stderr': result.stderr,
        'returncode': result.returncode
    }